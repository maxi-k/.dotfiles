#!/usr/bin/env sh

sysprompt="You are a helpful AI assistant living in a ubuntu shell environment. Respond very consicely and put a single executable shell command in a single code section. Don't ever reply with multiple code sections."
prompt="$@"

# query claude using CLI
res=$(claude --model "claude-haiku-4-5" --system-prompt "$sysprompt" "$prompt")

# exit if no response
test -z "$res" && echo "Error: No response from Claude" && exit 1

# extract shell command, replace newlines with ';'
cmd=$(echo "$res" | sed -n '/^```/,/^```/ p' | sed '/^```/ d' | sed 's/\n/; /g')

# Print response in full
echo "--------------------------------------------------------------------------------
$res
--------------------------------------------------------------------------------

Extracted Command: $cmd \033[1;34m"


# use xdotool to write suggested command to output prompt
if command -v xdotool >/dev/null; then
  xdotool type "$cmd"
else
  # alternative: confirm with user and run from inside this script;
  printf "%s" "$cmd"
  read -p "Run[1;34m $cmd [0m(y/n)?> " yn
  case $yn in
      [Nn]* ) echo "NOT Running"; exit;;
      * ) echo "Running..."; $cmd; break;;
  esac
fi
echo "
\033[0m
"
